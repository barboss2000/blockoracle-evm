<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Prediction Market — Robinhood EVM</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.min.js"></script>
  <style>
    body {
      background: #0b1220;
      color: white;
      font-family: Arial;
      text-align: center;
      padding: 40px;
    }

    .card {
      background: #1b2438;
      padding: 30px;
      border-radius: 15px;
      max-width: 600px;
      margin: auto;
    }

    button {
      padding: 12px 20px;
      margin: 10px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    .up { background: #16c784; color: black; }
    .down { background: #ea3943; color: white; }
    .claim { background: #f0b90b; }
    .settle { background: #5b6cff; }

    input {
      padding: 10px;
      width: 100px;
      border-radius: 5px;
      border: none;
      margin: 10px;
    }
  </style>
</head>
<body>

<h2>Prediction Market — Robinhood Testnet</h2>

<div class="card">
  <p><b>Wallet:</b> <span id="wallet">Not connected</span></p>
  <p><b>Round:</b> <span id="round">-</span></p>
  <p><b>UP Pool:</b> <span id="upPool">-</span> ETH</p>
  <p><b>DOWN Pool:</b> <span id="downPool">-</span> ETH</p>
  <p><b>Time left:</b> <span id="timer">-</span></p>

  <input type="number" id="amount" placeholder="ETH" step="0.01" />

  <br>

  <button class="up" onclick="betUp()">Bet UP</button>
  <button class="down" onclick="betDown()">Bet DOWN</button>

  <br>

  <button class="claim" onclick="claim()">Claim</button>
  <button class="settle" onclick="settle(true)">Settle UP</button>
  <button class="settle" onclick="settle(false)">Settle DOWN</button>

  <br><br>

  <button onclick="connect()">Connect Wallet</button>
</div>

<script>

const contractAddress = "0xeE53E37971040f9bb1cA74f9e57bA08B7ed0128c";

const abi = YOUR_ABI_HERE; // <-- Вставь сюда ABI

let provider;
let signer;
let contract;

async function connect() {
  if (!window.ethereum) {
    alert("Install MetaMask");
    return;
  }

  await ethereum.request({ method: "eth_requestAccounts" });

  provider = new ethers.BrowserProvider(window.ethereum);
  signer = await provider.getSigner();
  contract = new ethers.Contract(contractAddress, abi, signer);

  document.getElementById("wallet").innerText = await signer.getAddress();

  loadData();
  setInterval(loadData, 5000);
}

async function loadData() {
  const roundId = await contract.currentRound();
  document.getElementById("round").innerText = roundId;

  const round = await contract.rounds(roundId);

  document.getElementById("upPool").innerText =
    ethers.formatEther(round.upPool);

  document.getElementById("downPool").innerText =
    ethers.formatEther(round.downPool);

  const now = Math.floor(Date.now() / 1000);
  const timeLeft = Number(round.endTime) - now;

  document.getElementById("timer").innerText =
    timeLeft > 0 ? timeLeft + " sec" : "Ended";
}

async function betUp() {
  const eth = document.getElementById("amount").value;
  const tx = await contract.betUp({
    value: ethers.parseEther(eth)
  });
  await tx.wait();
  loadData();
}

async function betDown() {
  const eth = document.getElementById("amount").value;
  const tx = await contract.betDown({
    value: ethers.parseEther(eth)
  });
  await tx.wait();
  loadData();
}

async function claim() {
  const roundId = await contract.currentRound();
  const tx = await contract.claim(roundId);
  await tx.wait();
  loadData();
}

async function settle(outcome) {
  const tx = await contract.settle(outcome);
  await tx.wait();
  loadData();
}

</script>

</body>
</html>
